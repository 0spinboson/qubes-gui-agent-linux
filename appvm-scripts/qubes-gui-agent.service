[Unit]
Description=Qubes GUI Agent
After=qubes-meminfo-writer.service qubes-mount-dirs.service

[Service]
StandardInput=tty
TTYPath=/dev/tty7
# custom PATH for X session can be set with ENV_PATH; otherwise service's PATH
# is inherited
#Environment=ENV_PATH=/usr/local/bin:/usr/bin:/bin
# pretend tha user is at local console
ExecStartPre=/bin/mkdir -p /var/run/console ; /bin/touch /var/run/console/user
# Disable "transparent hugepage" feature, as it's incompatible with u2mfn module.
# See QubesOS/qubes-issues#5212 for details
ExecStartPre=/bin/sh -c 'p=/sys/kernel/mm/transparent_hugepage/enabled; fgrep -q [always] $p && echo madvise > $p; true'
ExecStart=/usr/bin/qubes-gui $GUI_OPTS
# clean env
ExecStopPost=/bin/rm -f /tmp/qubes-session-env /tmp/qubes-session-waiter
StandardOutput=syslog
Environment=DISPLAY=:0
EnvironmentFile=-/var/run/qubes-service-environment

[Install]
WantedBy=multi-user.target
